/* Optimized Three.js Scene for Production */
(()=>{const t={galaxy:{bg:"#0b0f18",accent:"#7dd3fc"},neural:{bg:"#0a0a0a",accent:"#a78bfa"},sunrise:{bg:"#1a2235",accent:"#fca5a5"}};function e(e){const n=t[e]||t.galaxy;document.documentElement.style.setProperty("--bg",n.bg),document.documentElement.style.setProperty("--accent",n.accent),localStorage.setItem("fic_theme",e)}document.querySelectorAll("[data-theme]").forEach(t=>{t.addEventListener("click",()=>e(t.dataset.theme))}),e(localStorage.getItem("fic_theme")||"galaxy");const n=document.getElementById("hero-canvas");if(!n||!window.THREE)return;const a=new THREE.Scene,r=new THREE.PerspectiveCamera(70,1,.1,2e3),o=new THREE.WebGLRenderer({canvas:n,antialias:!0,alpha:!0});o.setPixelRatio(Math.min(window.devicePixelRatio,2));const i=()=>{const t=n.clientWidth||window.innerWidth,e=n.clientHeight||Math.max(300,.7*window.innerHeight);o.setSize(t,e,!1),r.aspect=t/e,r.updateProjectionMatrix()};i(),window.addEventListener("resize",i),r.position.z=75;const c=(t,e,n,a)=>{const r=new THREE.BufferGeometry,o=new Float32Array(3*t);for(let e=0;e<t;e++)o[3*e+0]=800*(Math.random()-.5),o[3*e+1]=800*(Math.random()-.5),o[3*e+2]=1200*(Math.random()-.5);r.setAttribute("position",new THREE.BufferAttribute(o,3));const i=new THREE.PointsMaterial({size:e,color:n,transparent:!0,opacity:.8}),c=new THREE.Points(r,i);return c.userData={speed:a},c},l=[c(2e3,1.5,10486015,.02),c(1500,2,16777215,.015),c(1e3,2.5,10915050,.01)];l.forEach(t=>a.add(t));const s=new THREE.Group,d=new THREE.SphereGeometry(.9,16,16),h=[];for(let t=0;t<72;t++){const e=t/72*Math.PI*2,n=30+3*Math.sin(.35*t),r=new THREE.MeshBasicMaterial({color:8242684,transparent:!0,opacity:.7}),o=new THREE.Mesh(d,r);o.position.set(Math.cos(e)*n,4*Math.sin(1.2*e),Math.sin(e)*n),o.userData={originalScale:1,phase:.1*t},h.push(o),s.add(o)}a.add(s);const u=new THREE.BufferGeometry,g=500,f=new Float32Array(3*g),p=new Float32Array(3*g);for(let t=0;t<g;t++)f[3*t+0]=200*(Math.random()-.5),f[3*t+1]=200*(Math.random()-.5),f[3*t+2]=200*(Math.random()-.5),p[3*t+0]=.02*(Math.random()-.5),p[3*t+1]=.02*(Math.random()-.5),p[3*t+2]=.02*(Math.random()-.5);u.setAttribute("position",new THREE.BufferAttribute(f,3));const m=new THREE.PointsMaterial({color:43775,size:1,transparent:!0,opacity:.6,blending:THREE.AdditiveBlending}),w=new THREE.Points(u,m);a.add(w);const M=new THREE.Clock;let y=0;!function t(){const e=M.getElapsedTime();y++,l.forEach(t=>{t.rotation.y=e*t.userData.speed,t.rotation.x=.1*Math.sin(.1*e)}),s.rotation.y=.3*e,s.rotation.x=.3*Math.sin(.4*e),s.rotation.z=.1*Math.cos(.2*e),h.forEach((t,n)=>{const a=.3*Math.sin(2*e+t.userData.phase)+1;t.scale.setScalar(a),t.material.opacity=.4+.3*a});const n=w.geometry.attributes.position.array;for(let t=0;t<g;t++)n[3*t+0]+=p[3*t+0],n[3*t+1]+=p[3*t+1],n[3*t+2]+=p[3*t+2],Math.abs(n[3*t+0])>100&&(p[3*t+0]*=-1),Math.abs(n[3*t+1])>100&&(p[3*t+1]*=-1),Math.abs(n[3*t+2])>100&&(p[3*t+2]*=-1);w.geometry.attributes.position.needsUpdate=!0,r.position.x=2*Math.sin(.1*e),r.position.y=Math.cos(.15*e),r.lookAt(0,0,0),o.render(a,r),requestAnimationFrame(t)}(),matchMedia("(prefers-reduced-motion: reduce)").matches&&o.setAnimationLoop(null)})();